name: Update Quotes Daily

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update_quotes:
    name: ğŸš€ Daily Quote Updater
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ› ï¸ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      - name: ğŸ’¿ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
        continue-on-error: false
      - name: ğŸƒ Run Update Script
        id: run_script
        run: python update.py

      - name: ğŸ‘€ Check Changes (Git Status)
        if: success()
        run: |
          echo "ğŸ“‹ å½“å‰ Git çŠ¶æ€:"
          git status
          echo ""
          echo "ğŸ“„ CSV æ–‡ä»¶å˜åŒ–é¢„è§ˆ:"
          head -n 5 quotes.csv || echo "æ–‡ä»¶ä¸ºç©ºæˆ–ä¸å­˜åœ¨"

      - name: ğŸ“ Commit and Push Changes
        if: success()
        run: |
          # é…ç½® Git ç”¨æˆ·ä¿¡æ¯
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # æ·»åŠ æ–‡ä»¶å¹¶æ£€æŸ¥æ˜¯å¦æœ‰å˜åŠ¨
          git add quotes.csv
          
          # æ£€æŸ¥æ˜¯å¦æœ‰ä¸œè¥¿éœ€è¦æäº¤
          if git diff --staged --quiet; then
            echo "âœ¨ æ²¡æœ‰æ£€æµ‹åˆ°æ–°å˜åŒ–ï¼Œæ–‡ä»¶å¯èƒ½æœªæ›´æ–°ï¼ˆå†…å®¹é‡å¤ï¼‰ã€‚"
          else
            echo "ğŸ“¦ æ£€æµ‹åˆ°å˜åŒ–ï¼Œæ­£åœ¨æäº¤..."
            git commit -m "ğŸ“… [Daily Auto] Update quotes.csv $(date +'%Y-%m-%d')"
            git push
          fi

      - name: ğŸš¨ Handle Failure
        if: failure()
        run: |
          echo "::error::âŒ ä»»åŠ¡å¤±è´¥äº†ï¼è¯·æ£€æŸ¥ä¸Šæ–¹çš„ 'Run Update Script' æ—¥å¿—ã€‚"
          # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é€šçŸ¥çš„ä»£ç ï¼Œæ¯”å¦‚å‘é‚®ä»¶æˆ– Telegram
